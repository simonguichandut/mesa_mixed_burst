! Wind. Any zone with density below some threshold gets removed

&star_job

  saved_model_name = 'models/ns_env_tau1.mod'
  save_model_filename = 'models/ns_env_ejected.mod'

  set_initial_dt = .true.
  seconds_for_initial_dt = 1d-10

  pgstar_flag = .true.
  
  !! Run-specific inlist
  read_extra_star_job_inlist2 = .true.
  extra_star_job_inlist2_name = 'inlist_folder/inlist7_wind_extra'

/ ! end of star_job namelist

&controls

  !! Stopping condition (see run_star_extras)
  !x_logical_ctrl(3) = .true.  
  !$ x_ctrl(3) = 1d-15          ! stop when timestep drops below this (years)
  !$ x_ctrl(4) = 1d0            ! but only when star age greater than this (seconds)

  ! stop when sonic point crosses the photosphere (x_ctrl(4) applies)
  !x_logical_ctrl(4) = .true.  
  ! sometimes it makes it stop too early..

  !! Maximum time in case not reaching the condition
  max_age_in_seconds = 60d0

  !! Analytic electron scattering opacity from Paczynski
  use_other_kap = .true. ! see run_star_extras

  !! Enable custom routine for removing shells below minimum density
  use_other_remove_surface = .true. ! see run_star_extras
  x_ctrl(5) = 1d-7 ! minimum density threshold
  x_ctrl(6) = 1d0 ! stop searching beyond this density

  !! Wind only develops if energy_eqn = eps_grav. Otherwise outer grid cell just cools down forever while staying at the same density
  always_use_dedt_form_of_energy_eqn = .false.    
  always_use_eps_grav_form_of_energy_eqn = .true.
        
  !! Temperature gradient form
  ! This is more appropriate for non-hydrostatic situations (?)
  ! https://docs.mesastar.org/en/release-r21.12.1/reference/controls.html?highlight=use_dPrad_dm_form_of_T_gradient_eqn#use-gradt-actual-vs-gradt-mlt-for-t-gradient-eqn
  use_dPrad_dm_form_of_T_gradient_eqn = .true.

  !! Outer BC from YW18 (in turn from Quataert+2016)
  use_compression_outer_BC = .true.
  use_zero_dLdm_outer_BC = .true.

  !! turn off convection
  MLT_option = 'none'

  !! Atmosphere
  atm_option = 'T_tau'
  atm_T_tau_relation = 'Eddington'
  atm_T_tau_opacity = 'fixed'

  !! resolution
  mesh_delta_coeff = 0.5
  varcontrol_target = 0.5d-3
  time_delta_coeff = 0.1
  min_timestep_limit = 1d-20
  max_allowed_nz = 20000 

  merge_if_dlnR_too_small = .true.
  mesh_min_dlnR = 1d-9

  hydro_mtx_max_allowed_logRho = 10d0
  hydro_mtx_max_allowed_logT = 9.5d0

  !! Files
  photo_interval = 500
  profile_interval = 20
  max_num_profile_models = 1000
  history_interval = 1

  !! Force a high priority profile save at every x_ctrl(7) seconds
  x_ctrl(7) = 0.1d0
 
  !! Run-specific inlist
  read_extra_controls_inlist2 = .true.
  extra_controls_inlist2_name = 'inlist_folder/inlist7_wind_extra'

/ ! end of controls namelist
